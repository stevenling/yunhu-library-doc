<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>准备工作 | 云胡图书馆</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="图书下载网站">
    
    <link rel="preload" href="/yunhu-library-doc/assets/css/0.styles.167a3210.css" as="style"><link rel="preload" href="/yunhu-library-doc/assets/js/app.f639251b.js" as="script"><link rel="preload" href="/yunhu-library-doc/assets/js/2.6724f8fd.js" as="script"><link rel="preload" href="/yunhu-library-doc/assets/js/14.b5cb83ae.js" as="script"><link rel="prefetch" href="/yunhu-library-doc/assets/js/10.3bd8b304.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/11.b40bc51e.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/12.22fa385e.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/13.34eceb71.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/15.0b1e437f.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/16.f410b612.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/17.0f58fcec.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/18.472ef1ae.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/19.3643e322.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/20.a2b70aef.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/21.48d9afb8.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/22.ca78e76f.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/23.ada283eb.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/3.c885067c.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/4.92453b9d.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/5.579ec30a.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/6.4247d11e.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/7.cdf91b64.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/8.4b0c70ea.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/9.baeabbc9.js">
    <link rel="stylesheet" href="/yunhu-library-doc/assets/css/0.styles.167a3210.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yunhu-library-doc/" class="home-link router-link-active"><!----> <span class="site-name">云胡图书馆</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/design/prepare.html" aria-current="page" class="active sidebar-link">准备工作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yunhu-library-doc/design/prepare.html#npm-知识点" class="sidebar-link">npm 知识点</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/design/prepare.html#vue-项目主要依赖库" class="sidebar-link">Vue 项目主要依赖库</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/design/prepare.html#spring-boot-项目主要依赖库" class="sidebar-link">Spring Boot 项目主要依赖库</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/design/prepare.html#python-项目主要依赖库" class="sidebar-link">Python 项目主要依赖库</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/design/prepare.html#域名配置" class="sidebar-link">域名配置</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/design/prepare.html#" class="sidebar-link"></a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/feature/login.html" class="sidebar-link">登录</a></li><li><a href="/yunhu-library-doc/feature/register.html" class="sidebar-link">注册</a></li><li><a href="/yunhu-library-doc/feature/main.html" class="sidebar-link">主页</a></li><li><a href="/yunhu-library-doc/feature/top-menu.html" class="sidebar-link">顶部导航栏</a></li><li><a href="/yunhu-library-doc/feature/search.html" class="sidebar-link">搜索书籍</a></li><li><a href="/yunhu-library-doc/feature/onlineRead.html" class="sidebar-link">在线阅读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>详细设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/detail-design/client-token.html" class="sidebar-link">vue token 配置</a></li><li><a href="/yunhu-library-doc/detail-design/route.html" class="sidebar-link">路由拦截</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发日志</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/log/" class="sidebar-link">日志</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>书籍目录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/book-catalogue/epub-catalogue.html" class="sidebar-link">epub 书籍目录</a></li><li><a href="/yunhu-library-doc/book-catalogue/pdf-catalogue.html" class="sidebar-link">pdf 书籍目录</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h1> <h2 id="npm-知识点"><a href="#npm-知识点" class="header-anchor">#</a> npm 知识点</h2> <h3 id="安装-package"><a href="#安装-package" class="header-anchor">#</a> 安装 package</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> package <span class="token comment"># 局部安装</span>

<span class="token function">npm</span> <span class="token function">install</span> package -g <span class="token comment"># 全局安装</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="列举项目中安装的包"><a href="#列举项目中安装的包" class="header-anchor">#</a> 列举项目中安装的包</h3> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token function">npm</span> list <span class="token comment"># 列举项目底下安装的包</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="vue-项目主要依赖库"><a href="#vue-项目主要依赖库" class="header-anchor">#</a> Vue 项目主要依赖库</h2> <table><thead><tr><th>库名</th> <th>功能</th> <th>安装命令</th></tr></thead> <tbody><tr><td>axios</td> <td>网络请求</td> <td>npm install axios</td></tr> <tr><td>Element Plus</td> <td>界面的组件库</td> <td>npm install element-plus --save</td></tr> <tr><td>@element-plus/icons-vue</td> <td>Element Plus 图表</td> <td>npm install @element-plus/icons-vue</td></tr> <tr><td>vue-router</td> <td>Vue.js 的官方路由</td> <td>npm install vue-router</td></tr> <tr><td>vuex</td> <td>Vue 项目的状态管理模式 + 库</td> <td>npm install vuex@next --save</td></tr> <tr><td>epubjs</td> <td>解析 epub 电子书</td> <td>npm install epubjs</td></tr> <tr><td><a href="https://day.js.org/zh-CN/" target="_blank" rel="noopener noreferrer">dayjs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td> <td>轻量的处理时间和日期的 JavaScript 库</td> <td>npm install dayjs</td></tr> <tr><td>postcss-pxtorem</td> <td>自适应适配</td> <td></td></tr></tbody></table> <h2 id="spring-boot-项目主要依赖库"><a href="#spring-boot-项目主要依赖库" class="header-anchor">#</a> Spring Boot 项目主要依赖库</h2> <table><thead><tr><th>库名</th> <th>功能</th></tr></thead> <tbody><tr><td>jwt</td> <td>生成、验证 token</td></tr> <tr><td>cos_api</td> <td>腾讯云对象存储</td></tr></tbody></table> <h2 id="python-项目主要依赖库"><a href="#python-项目主要依赖库" class="header-anchor">#</a> Python 项目主要依赖库</h2> <table><thead><tr><th>库名</th> <th>功能</th></tr></thead> <tbody><tr><td>BeautifulSoup</td> <td>解析网页，获取网页数据</td></tr> <tr><td>fake_useragent</td> <td>随机生成 User Agent，爬虫请求不被发现</td></tr> <tr><td>csv</td> <td>读取 csv 文件，用来插入书籍图片和文件链接到数据表的字段中</td></tr> <tr><td>re</td> <td>正则表达式处理</td></tr> <tr><td>mysql.connector</td> <td>连接 mysql 数据库支持</td></tr></tbody></table> <h2 id="域名配置"><a href="#域名配置" class="header-anchor">#</a> 域名配置</h2> <p>申请域名时，域名服务商会给我们一个主域名，我的主域名是 <code>yunhu.wiki</code> 绑定了我的个人站，那么我的图书馆网站要放在哪里？</p> <p>一个 <code>IP</code>地址和一个端口可以唯一标识一个服务，那样的话，就可以用 <code>yunhu.wiki:9049</code> 来唯一确定我的图书馆网址。</p> <p>这样又有一个问题，你把图书馆网站分享给别人，别人还要写上端口，不规范且不优雅。</p> <p>我的最初解决方案是在「云解析 <code>DNS</code> 」中添加一条「隐形 <code>URL</code>」 记录，用一个二级域名<code>library.yunhu.wiki</code> 指向 <code>yunhu.wiki:9049</code>，这样用户表面上访问的是 <code>library.yunhu.wiki</code>，实际上访问的是 <code>yunhu.wiki:9049</code>。</p> <p>回到正题，我们要给 <code>library.yunhu.wiki</code>添加 <code>https</code>，此时不能用隐形 <code>URL</code> ，因为在腾讯云「隐/显性 <code>URL</code> 记录」文档中可以看到如下说明：</p> <blockquote><p>URL 转发记录转发前，地址仅支持 HTTP、不支持 HTTPS；<br><br>
转发后地址支持 HTTP 及 HTTPS ；</p></blockquote> <p>我们需要换一个方案，那就是使用 <code>CNAME</code>记录，<code>CNAME</code> 记录可以将一个域名映射到另外一个域名，于是我将 <code>library.yunhu.wiki</code> 这个二级域名映射到 <code>yunhu.wiki</code> 这个主域名。</p> <p>然后申请 <code>SSL</code>证书，通过后下载 <code>nginx</code> 版本的证书，然后在 <code>nginx</code> 中配置，这边还有一个重要的知识点，以下是我的 <code>nginx</code> 配置文件。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name yunhu.wiki<span class="token punctuation">;</span>
    rewrite ^<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name yunhu.wiki<span class="token punctuation">;</span>

    <span class="token comment"># SSL 验证相关配置</span>
    ssl_certificate /etc/nginx/cert/yunhu.wiki.pem<span class="token punctuation">;</span>
    ssl_certificate_key /etc/nginx/cert/yunhu.wiki.key<span class="token punctuation">;</span>

    <span class="token comment"># 缓存有效期</span>
    ssl_session_timeout 5m<span class="token punctuation">;</span>
    <span class="token comment"># 加密算法</span>
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:<span class="token operator">!</span>NULL:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5:<span class="token operator">!</span>ADH:<span class="token operator">!</span>RC4<span class="token punctuation">;</span>

    <span class="token comment"># 安全链接可选的加密协议</span>
    ssl_protocols TLSv1.2 TLSv1.3<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        root /var/www/html<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
        try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
    proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name library.yunhu.wiki<span class="token punctuation">;</span>
    rewrite ^<span class="token punctuation">(</span>.*<span class="token punctuation">)</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span> permanent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> ssl<span class="token punctuation">;</span>
    server_name library.yunhu.wiki<span class="token punctuation">;</span>

    <span class="token comment"># SSL 验证相关配置</span>
    ssl_certificate /etc/nginx/cert/library.yunhu.wiki.pem<span class="token punctuation">;</span>
    ssl_certificate_key /etc/nginx/cert/library.yunhu.wiki.key<span class="token punctuation">;</span>
    <span class="token comment"># 缓存有效期</span>
    ssl_session_timeout 5m<span class="token punctuation">;</span>
    <span class="token comment"># 安全链接可选的加密协议</span>
    ssl_protocols TLSv1.2 TLSv1.3<span class="token punctuation">;</span>
    <span class="token comment"># 加密算法</span>
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:<span class="token operator">!</span>NULL:<span class="token operator">!</span>aNULL:<span class="token operator">!</span>MD5:<span class="token operator">!</span>ADH:<span class="token operator">!</span>RC4<span class="token punctuation">;</span>

    location / <span class="token punctuation">{</span>
        root /root/library/library-web-vue/dist<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
        try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location ^~/api/ <span class="token punctuation">{</span>
        rewrite ^/api/<span class="token punctuation">(</span>.*<span class="token punctuation">)</span>$ /<span class="token variable">$1</span> <span class="token builtin class-name">break</span><span class="token punctuation">;</span>
        proxy_pass http://10.0.12.16:8090/<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
    proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
    proxy_set_header X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>

    access_log /var/log/nginx/library_access.log<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>可以看到两个 <code>server</code>块都监听了 <code>80</code> 和 <code>443</code> 端口，可能有人会说，你前面说过了 <code>IP</code> 和端口号确定唯一一个服务，你现在怎么两个服务都在 <code>443</code> 端口？</p> <p>知识点来了，<code>nginx</code>有一种虚拟主机技术，可以把一台物理服务器划分成多个虚拟的服务器，就好像拥有多台服务器一样，虚拟主机之间完全互相独立，彼此互不干扰。</p> <p>这边用到的是里面的一种基于域名的虚拟主机， 通过 <code>server_name</code> 来确定要将请求发送到哪个虚拟主机，从而实现在一个 <code>IP</code> 地址上托管多个域名。</p> <h2 id=""><a href="#" class="header-anchor">#</a></h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/yunhu-library-doc/feature/login.html">
        登录
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yunhu-library-doc/assets/js/app.f639251b.js" defer></script><script src="/yunhu-library-doc/assets/js/2.6724f8fd.js" defer></script><script src="/yunhu-library-doc/assets/js/14.b5cb83ae.js" defer></script>
  </body>
</html>
