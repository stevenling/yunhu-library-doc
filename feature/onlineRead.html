<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在线阅读 | 云胡图书馆</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="图书下载网站">
    
    <link rel="preload" href="/yunhu-library-doc/assets/css/0.styles.167a3210.css" as="style"><link rel="preload" href="/yunhu-library-doc/assets/js/app.f639251b.js" as="script"><link rel="preload" href="/yunhu-library-doc/assets/js/2.6724f8fd.js" as="script"><link rel="preload" href="/yunhu-library-doc/assets/js/3.c885067c.js" as="script"><link rel="prefetch" href="/yunhu-library-doc/assets/js/10.3bd8b304.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/11.b40bc51e.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/12.22fa385e.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/13.34eceb71.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/14.b5cb83ae.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/15.0b1e437f.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/16.f410b612.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/17.0f58fcec.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/18.472ef1ae.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/19.3643e322.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/20.a2b70aef.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/21.48d9afb8.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/22.ca78e76f.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/23.ada283eb.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/4.92453b9d.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/5.579ec30a.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/6.4247d11e.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/7.cdf91b64.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/8.4b0c70ea.js"><link rel="prefetch" href="/yunhu-library-doc/assets/js/9.baeabbc9.js">
    <link rel="stylesheet" href="/yunhu-library-doc/assets/css/0.styles.167a3210.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yunhu-library-doc/" class="home-link router-link-active"><!----> <span class="site-name">云胡图书馆</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开始</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/design/prepare.html" class="sidebar-link">准备工作</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/feature/login.html" class="sidebar-link">登录</a></li><li><a href="/yunhu-library-doc/feature/register.html" class="sidebar-link">注册</a></li><li><a href="/yunhu-library-doc/feature/main.html" class="sidebar-link">主页</a></li><li><a href="/yunhu-library-doc/feature/top-menu.html" class="sidebar-link">顶部导航栏</a></li><li><a href="/yunhu-library-doc/feature/search.html" class="sidebar-link">搜索书籍</a></li><li><a href="/yunhu-library-doc/feature/onlineRead.html" aria-current="page" class="active sidebar-link">在线阅读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yunhu-library-doc/feature/onlineRead.html#添加目录" class="sidebar-link">添加目录</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/feature/onlineRead.html#文本选中高亮" class="sidebar-link">文本选中高亮</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/feature/onlineRead.html#主题切换" class="sidebar-link">主题切换</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/feature/onlineRead.html#划线位置添加-tooltip" class="sidebar-link">划线位置添加 tooltip</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/feature/onlineRead.html#分享书摘" class="sidebar-link">分享书摘</a></li><li class="sidebar-sub-header"><a href="/yunhu-library-doc/feature/onlineRead.html#分享书摘美化、切换背景" class="sidebar-link">分享书摘美化、切换背景</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>详细设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/detail-design/client-token.html" class="sidebar-link">vue token 配置</a></li><li><a href="/yunhu-library-doc/detail-design/route.html" class="sidebar-link">路由拦截</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发日志</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/log/" class="sidebar-link">日志</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>书籍目录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yunhu-library-doc/book-catalogue/epub-catalogue.html" class="sidebar-link">epub 书籍目录</a></li><li><a href="/yunhu-library-doc/book-catalogue/pdf-catalogue.html" class="sidebar-link">pdf 书籍目录</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="在线阅读"><a href="#在线阅读" class="header-anchor">#</a> 在线阅读</h1> <p>在线阅读是云胡图书馆的核心。</p> <h2 id="添加目录"><a href="#添加目录" class="header-anchor">#</a> 添加目录</h2> <p>给「云胡图书馆」的目录美化，之前的目录在左侧，不太好看，改为新的样式组件抽屉 (Drawer )，点击可以从右到左侧边展开。</p> <p><code>epub</code> 格式的电子书本质上是一个 <code>html</code>，它的样式是通过 <code>css</code>生成的，<code>epub</code> 电子书的目录是一个数组，以下是一个示例：</p> <p>盗墓笔记这本书的部分目录，太长了，我只截取部分。</p> <p><code>href</code>是目标位置，使我们可以跳转到指定位置，比如某一章节。</p> <p><code>label</code>是章节的中文名称</p> <p><code>subitems</code>是子章节，子章节也可以有自己的子章节。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;coverpage&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;coverpage.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;封面&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter898&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter898.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;总目录&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter443&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter443.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第一季&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444.html&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第一卷 七星鲁王&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter457&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter457.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第一章 血尸&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter458&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter458.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第二章 五十年后&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter459&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter459.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第三章 瓜子庙&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter460&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter460.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第四章 尸洞&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter461&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter461.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第五章 水影&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter462&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter462.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第六章 积尸地&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter463&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter463.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第七章 一百多个人头&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter464&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter464.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第八章 山谷&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter465&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter465.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第九章 古墓&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter466&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter466.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十章 影子&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter467&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter467.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十一章 七星棺&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter468&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter468.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十二章 门&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter469&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter469.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十三章 02200059&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter470&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter470.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十四章 闷油瓶&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter471&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter471.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十五章 屁&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter472&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter472.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十六章 小手&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter473&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter473.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十七章 洞&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter474&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter474.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十八章 大树&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter475&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter475.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第十九章 女尸&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter476&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter476.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第二十章 钥匙&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter477&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;href&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter477.html&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;label&quot;</span><span class="token operator">:</span> <span class="token string">&quot;第二十一章 青眼狐尸&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;subitems&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;parent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chapter444&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br></div></div><p>渲染出来的结果是：</p> <p><img src="/yunhu-library-doc/assets/img/20231119_225500.06031d1f.png" alt=""></p> <p>对不同级别的章节做了不同的缩进层次，看起来比较美观。</p> <h2 id="文本选中高亮"><a href="#文本选中高亮" class="header-anchor">#</a> 文本选中高亮</h2> <p>给「云胡图书馆」添加文本选中高亮功能</p> <p>监听选中事件，然后将其高亮。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>rendition<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'selected'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cfiRange<span class="token punctuation">,</span> contents</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  rendition<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span><span class="token function">highlight</span><span class="token punctuation">(</span>cfiRange<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">'#9370DB'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  book<span class="token punctuation">.</span><span class="token function">getRange</span><span class="token punctuation">(</span>cfiRange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    selectText<span class="token punctuation">.</span>value <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  contents<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>高亮效果：</p> <p><img src="/yunhu-library-doc/assets/img/20230921_143458.bf0f3e7a.png" alt=""></p> <h2 id="主题切换"><a href="#主题切换" class="header-anchor">#</a> 主题切换</h2> <p>给「云胡图书馆」加上主题切换功能。</p> <h3 id="定义主题样式列表"><a href="#定义主题样式列表" class="header-anchor">#</a> 定义主题样式列表</h3> <p><code>color</code> 代表字体颜色，<code>background</code> 代表背景颜色</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 主题样式列表</span>
<span class="token keyword">const</span> themeStyleList <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'default'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000000'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'#c5c5c5'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'eye'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000000'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'#d2efd1'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'night'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#FFFFFF'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'#000000'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'gold'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000000'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'#f7efe2'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#000000'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'#FFFFFF'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="循环遍历注册主题"><a href="#循环遍历注册主题" class="header-anchor">#</a> 循环遍历注册主题</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 注册主题</span>
themeStyleList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  rendition<span class="token punctuation">.</span>themes<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>name<span class="token punctuation">,</span> element<span class="token punctuation">.</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="选择某一个主题"><a href="#选择某一个主题" class="header-anchor">#</a> 选择某一个主题</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>rendition<span class="token punctuation">.</span>themes<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'gold'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="切换主题"><a href="#切换主题" class="header-anchor">#</a> 切换主题</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">chooseTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">selectTheme</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rendition<span class="token punctuation">.</span>themes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    rendition<span class="token punctuation">.</span>themes<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>selectTheme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="结果"><a href="#结果" class="header-anchor">#</a> 结果</h3> <p><img src="/yunhu-library-doc/assets/img/20231007-143052.7de1fee6.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231007-143308.37e2f04b.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231007-143333.d9f69916.png" alt=""></p> <h2 id="划线位置添加-tooltip"><a href="#划线位置添加-tooltip" class="header-anchor">#</a> 划线位置添加 tooltip</h2> <p>为「云胡图书馆」添加在划线位置的 <code>Tooltip</code>，上面再通过插槽添加三个按钮，分别是复制、高亮和分享书摘。</p> <p>鼠标事件的三组属性：</p> <ol><li>MouseEvent.pageX 和 MouseEvent.pageY</li></ol> <p>这边我们只探讨 <code>Y</code> 方向，<code>X</code> 方向的知识是类似的。</p> <p><code>pageY</code>会返回触发事件的位置相对于整个文档的 <code>Y</code> 坐标值，由于书籍是一个可以下滑的文档，因此下滑之后，<code>pageY</code>会一直增大，因此鼠标划线位置超过一屏，</p> <p><code>Tooltip</code>位置就会在下方，无法实现我们要的功能。</p> <ol start="2"><li>MouseEvent.clientX 和 MouseEvent.clientY</li></ol> <p><code>clentY</code> 会返回鼠标指针在浏览器客户区域的垂直坐标，按理论来说页面向下滑动，这个垂直坐标还是相对于坐标原点，但是可能 <code>epub.js</code> 重写了这方面的逻辑，我还是获取不到。</p> <ol start="3"><li>MouseEvent.screenX 和 MouseEvent.screenY</li></ol> <p><code>screenY</code>提供了事件发生时鼠标指针相对于用户屏幕的垂直坐标，这是我们想要的，由于事先不知道这个属性，然后又想监听滑动距离去算出相对于屏幕顶点的高度，花了大概 <code>12</code> 个小时也没弄好，走了很长的弯路，后面才知道有这个属性。</p> <p>结果：</p> <p><img src="/yunhu-library-doc/assets/img/20231119_225600.b3ea0a56.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231119_225700.4ba6e481.png" alt=""></p> <h2 id="分享书摘"><a href="#分享书摘" class="header-anchor">#</a> 分享书摘</h2> <p>由于我个人特别喜欢「微信读书 app」 的分享书摘功能，于是就打算自己模仿一个，思路是先拿到用户选中的文本字符串，点击分享书摘按钮，然后通过 <code>canvas</code> 把文字画成一张图。</p> <p><img src="/yunhu-library-doc/assets/img/20230921_143553.63d71f93.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20230921_143708.d898d83f.png" alt=""></p> <p>先画背景渐变色，然后绘制最上面的图片，然后对字符串进行分行，最后再一行一行画出来，最后是画一条线和云胡图书馆标志。</p> <p><code>canvas</code> 绘制还有问题，就是会很模糊，这是为什么呢？</p> <p>普通屏幕的像素（逻辑像素）和物理像素相等，比如 <code>100px</code> 逻辑像素绘制出 <code>100px</code> 物理像素，也就是我们看到的大小。</p> <p>但是在高分屏屏幕上，<code>window.devicePixelRatio</code> 表示当前显示设备的物理像素分辨率与 <strong><code>CSS</code></strong> 像素分辨率之比，简称 <code>dpr</code>。</p> <p>如果 <code>window.devicePixelRatio</code> 值为 <code>2</code>，那么设置 <code>100px</code> 逻辑像素，实际上用到的物理像素是 <code>200px</code>。</p> <p>不管是否为高分屏， <code>canvas</code> 中的单位 <code>1</code>逻辑像素，就是 <code>1</code> 物理像素，那么用 <code>canvas</code> 画出来的 <code>100px</code> 逻辑像素，显示出来的物理像素也是 <code>100px</code>。</p> <p>问题来了，如果 <code>dpr</code> 是 <code>2</code>，理论上要显示 <code>200px</code>，这时候浏览器使用了图像算法将另外 <code>100px</code>的像素值填充，这时候就出现了模糊。</p> <p>解决办法：</p> <p>假设 <code>dpr</code> 为 <code>2</code>，逻辑像素为 <code>100px</code>。</p> <ul><li><p>通过 <code>css</code> 设置 <code>canvas</code> 元素的大小为逻辑像素大小。</p></li> <li><p>将 <code>canvas</code> 画布大小乘以 <code>2</code> 转换成实际像素（物理像素）大小，原来的 <code>100</code> 个像素是靠算法生成的会模糊，现在的 <code>200</code> 个像素全是原生的像素，这样就不会模糊。</p></li> <li><p>现在是画布的大小准备好了，不代表画上去就会直接乘 <code>2</code>，因此需要通过 <code>scale</code> 整体绘制时放大两倍。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>canvas <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> ratio <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>

  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> ratio<span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>ratio<span class="token punctuation">,</span> ratio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul> <p>由于 <code>canvas</code> 画布大小变为原来 <code>2</code> 倍，所以原来有使用到 <code>canvas</code> 的大小要记得除于 <code>2</code>。</p> <h2 id="分享书摘美化、切换背景"><a href="#分享书摘美化、切换背景" class="header-anchor">#</a> 分享书摘美化、切换背景</h2> <p>给「云胡图书馆」的分享书摘功能美化和增加文本高度自适应以及切换背景。</p> <p>实现的过程中遇到了两个问题。</p> <ol><li>原来只有一个背景，我增加了 <code>7</code> 个，现在总共有八种背景，更改背景的实现原理很简单，就是重新绘制背景色和文本内容，如果字体颜色需要改变，那么也跟着变化就行。</li></ol> <p>一切都很正常的时候，发现重新绘制头像一直有问题，后面发现头像是通过 <code>canvas</code> 裁剪出来的圆形区域，浏览器会将之后的绘图操作限制在那个裁剪的圆形区域内执行，因此需要在绘制头像后取消裁剪区域，才能达到我们想要的效果。</p> <p>在裁剪前保存状态 <code>save()</code>，在 <code>clip()</code>裁剪之后使用 <code>restore()</code> 恢复之前的状态。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>image<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 设置圆的属性</span>
  <span class="token comment">// 圆心的 x 坐标</span>
  <span class="token comment">// 圆心的 y 坐标</span>
  <span class="token keyword">let</span> centerX <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> centerY <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
  <span class="token comment">// 圆的半径</span>
  <span class="token keyword">let</span> radius <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 开始创建圆形路径</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 裁剪出圆形区域</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">clip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>
    image<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    centerX <span class="token operator">-</span> radius<span class="token punctuation">,</span>
    centerY <span class="token operator">-</span> radius<span class="token punctuation">,</span>
    <span class="token number">2</span> <span class="token operator">*</span> radius<span class="token punctuation">,</span>
    <span class="token number">2</span> <span class="token operator">*</span> radius
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  currentCtx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol start="2"><li>书摘文本高度自适应问题</li></ol> <p>思路是每一次用户点击分享书摘，都要计算一下文本的高度，然后通过这个高度重新设置 <code>canvas</code> 画布的高度，由于书摘图片还包括头像、用户名、摘录时间、书名、作者名、分割线、云胡图书馆标志，因此画布的高度还要再加上一些，我这边设置了 <code>700</code>。</p> <p>我在处理的时候，发现高度存在问题，老是覆盖到书名作者名那边了。</p> <p>由于存在高分屏 <code>canvas</code> 模糊的问题，必须对绘图进行放大，放大后的 <code>canvas</code>计算字符的宽度也会变大，导致行数变多了，因此就把底下的书名和作者名覆盖了，我通过放大前字符宽度的比例和一行文本的最大宽度比例进行对应，从而解决这个问题。
我现在很喜欢这个分享书摘功能，可以把自己想看的并且微信读书中没有的书导进来，然后也可以分享书摘自己保存或者给朋友看。</p> <p><img src="/yunhu-library-doc/assets/img/20231119_224700.9ef02b5b.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231119_224800.e0ae8e56.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231119_224830.89a20014.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231119_224900.3429bf4d.png" alt=""></p> <p><img src="/yunhu-library-doc/assets/img/20231119_224930.d9e3a93c.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yunhu-library-doc/feature/search.html" class="prev">
        搜索书籍
      </a></span> <span class="next"><a href="/yunhu-library-doc/detail-design/client-token.html">
        vue token 配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yunhu-library-doc/assets/js/app.f639251b.js" defer></script><script src="/yunhu-library-doc/assets/js/2.6724f8fd.js" defer></script><script src="/yunhu-library-doc/assets/js/3.c885067c.js" defer></script>
  </body>
</html>
